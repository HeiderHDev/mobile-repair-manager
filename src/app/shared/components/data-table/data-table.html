<p-card>
    @if (config().title) {
      <ng-template pTemplate="header">
        <div class="flex justify-between items-center p-4">
          <h2 class="text-2xl font-bold text-surface-900 dark:text-surface-0 m-0">
            {{ config().title }}
          </h2>
          @if (config().showAddButton && config().onAdd) {
            <p-button
              [label]="config().addButtonLabel || 'Agregar'"
              icon="pi pi-plus"
              (onClick)="handleAdd()"
            ></p-button>
          }
        </div>
      </ng-template>
    }

    <ng-template pTemplate="content">
      <!-- Search Bar -->
      @if (config().showSearch) {
        <div class="mb-4">
          <div class="p-input-icon-left w-full md:w-auto">
            <i class="pi pi-search"></i>
            <input
              pInputText
              type="text"
              [placeholder]="config().searchPlaceholder || 'Buscar...'"
              [formControl]="searchControl"
              class="w-full md:w-auto"
            />
          </div>
        </div>
      }

      <!-- Table -->
      <p-table
        [value]="filteredData()"
        [paginator]="config().paginator ?? true"
        [rows]="config().rows ?? 10"
        [rowsPerPageOptions]="config().rowsPerPageOptions ?? [5, 10, 20]"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} registros"
        styleClass="p-datatable-striped"
        responsiveLayout="scroll"
      >
        <ng-template pTemplate="header">
          <tr>
            @for (column of config().columns; track column.field) {
              <th
                [pSortableColumn]="column.sortable ? getSortableField(column.field) : undefined"
                [style.width]="column.width"
              >
                <div class="flex align-items-center">
                  {{ column.header }}
                  @if (column.sortable) {
                    <p-sortIcon [field]="getSortableField(column.field)"></p-sortIcon>
                  }
                </div>
              </th>
            }
            @if (hasActions()) {
              <th style="width: 200px">Acciones</th>
            }
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-item let-rowIndex="rowIndex">
          <tr>
            @for (column of config().columns; track column.field) {
              <td>
                @switch (column.type) {
                  @case ('date') {
                    {{ formatDate(item[column.field]) }}
                  }
                  @case ('boolean') {
                    <p-tag
                      [value]="item[column.field] ? 'Activo' : 'Inactivo'"
                      [severity]="item[column.field] ? 'success' : 'danger'"
                    ></p-tag>
                  }
                  @case ('template') {
                    @if (column.template) {
                      <ng-container
                        *ngTemplateOutlet="column.template; context: { $implicit: item, rowIndex: rowIndex }"
                      ></ng-container>
                    }
                  }
                  @default {
                    {{ item[column.field] || '-' }}
                  }
                }
              </td>
            }
            @if (hasActions()) {
              <td>
                <div class="flex gap-2">
                  @for (action of getVisibleActions(item); track action.label) {
                    <p-button
                      [icon]="action.icon"
                      [label]="action.label"
                      [severity]="action.severity || 'secondary'"
                      size="small"
                      [disabled]="action.disabled?.(item) || false"
                      (onClick)="executeAction(action, item)"
                    ></p-button>
                  }
                </div>
              </td>
            }
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td [attr.colspan]="getTotalColumns()">
              <div class="text-center py-8">
                <i class="pi pi-info-circle text-4xl text-surface-400 mb-4"></i>
                <p class="text-surface-600 dark:text-surface-300 text-lg">
                  {{ config().emptyMessage || 'No hay datos para mostrar' }}
                </p>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </ng-template>
  </p-card>

  <p-confirmDialog></p-confirmDialog>
  <p-toast></p-toast>